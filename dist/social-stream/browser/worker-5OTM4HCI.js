var v=t=>r=>Object.values(t).includes(r);var x;(n=>{let t;(p=>p.ComputeStats="COMPUTE_POST_TYPE_STATS")(t=n.Commands||={});let r;(p=>p.StatsComputed="POST_TYPE_STATS_COMPUTED")(r=n.Messages||={});let e;(h=>(h.InvalidCommand="INVALID_COMMAND",h.InvalidMessage="INVALID_MESSAGE"))(e=n.Errors||={}),n.isValidCommand=i=>v(t)(i),n.isValidMessage=i=>v(r)(i)})(x||={});function a(t){return typeof t=="function"}function T(t){let e=t(o=>{Error.call(o),o.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var g=T(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((o,s)=>`${s+1}) ${o.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function P(t,r){if(t){let e=t.indexOf(r);0<=e&&t.splice(e,1)}}var u=class t{constructor(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let r;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let n of e)n.remove(this);else e.remove(this);let{initialTeardown:o}=this;if(a(o))try{o()}catch(n){r=n instanceof g?n.errors:[n]}let{_finalizers:s}=this;if(s){this._finalizers=null;for(let n of s)try{R(n)}catch(i){r=r??[],i instanceof g?r=[...r,...i.errors]:r.push(i)}}if(r)throw new g(r)}}add(r){var e;if(r&&r!==this)if(this.closed)R(r);else{if(r instanceof t){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(r)}}_hasParent(r){let{_parentage:e}=this;return e===r||Array.isArray(e)&&e.includes(r)}_addParent(r){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(r),e):e?[e,r]:r}_removeParent(r){let{_parentage:e}=this;e===r?this._parentage=null:Array.isArray(e)&&P(e,r)}remove(r){let{_finalizers:e}=this;e&&P(e,r),r instanceof t&&r._removeParent(this)}};u.EMPTY=(()=>{let t=new u;return t.closed=!0,t})();var I=u.EMPTY;function E(t){return t instanceof u||t&&"closed"in t&&a(t.remove)&&a(t.add)&&a(t.unsubscribe)}function R(t){a(t)?t():t.unsubscribe()}var c={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var b={setTimeout(t,r,...e){let{delegate:o}=b;return o?.setTimeout?o.setTimeout(t,r,...e):setTimeout(t,r,...e)},clearTimeout(t){let{delegate:r}=b;return(r?.clearTimeout||clearTimeout)(t)},delegate:void 0};function D(t){b.setTimeout(()=>{let{onUnhandledError:r}=c;if(r)r(t);else throw t})}function C(){}var N=O("C",void 0,void 0);function L(t){return O("E",void 0,t)}function B(t){return O("N",t,void 0)}function O(t,r,e){return{kind:t,value:r,error:e}}var f=null;function S(t){if(c.useDeprecatedSynchronousErrorHandling){let r=!f;if(r&&(f={errorThrown:!1,error:null}),t(),r){let{errorThrown:e,error:o}=f;if(f=null,e)throw o}}else t()}function Y(t){c.useDeprecatedSynchronousErrorHandling&&f&&(f.errorThrown=!0,f.error=t)}var l=class extends u{constructor(r){super(),this.isStopped=!1,r?(this.destination=r,E(r)&&r.add(this)):this.destination=sr}static create(r,e,o){return new y(r,e,o)}next(r){this.isStopped?k(B(r),this):this._next(r)}error(r){this.isStopped?k(L(r),this):(this.isStopped=!0,this._error(r))}complete(){this.isStopped?k(N,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(r){this.destination.next(r)}_error(r){try{this.destination.error(r)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},tr=Function.prototype.bind;function F(t,r){return tr.call(t,r)}var V=class{constructor(r){this.partialObserver=r}next(r){let{partialObserver:e}=this;if(e.next)try{e.next(r)}catch(o){A(o)}}error(r){let{partialObserver:e}=this;if(e.error)try{e.error(r)}catch(o){A(o)}else A(r)}complete(){let{partialObserver:r}=this;if(r.complete)try{r.complete()}catch(e){A(e)}}},y=class extends l{constructor(r,e,o){super();let s;if(a(r)||!r)s={next:r??void 0,error:e??void 0,complete:o??void 0};else{let n;this&&c.useDeprecatedNextContext?(n=Object.create(r),n.unsubscribe=()=>this.unsubscribe(),s={next:r.next&&F(r.next,n),error:r.error&&F(r.error,n),complete:r.complete&&F(r.complete,n)}):s=r}this.destination=new V(s)}};function A(t){c.useDeprecatedSynchronousErrorHandling?Y(t):D(t)}function or(t){throw t}function k(t,r){let{onStoppedNotification:e}=c;e&&b.setTimeout(()=>e(t,r))}var sr={closed:!0,next:C,error:or,complete:C};var J=typeof Symbol=="function"&&Symbol.observable||"@@observable";function q(t){return t}function G(t){return t.length===0?q:t.length===1?t[0]:function(e){return t.reduce((o,s)=>s(o),e)}}var d=class t{constructor(r){r&&(this._subscribe=r)}lift(r){let e=new t;return e.source=this,e.operator=r,e}subscribe(r,e,o){let s=ir(r)?r:new y(r,e,o);return S(()=>{let{operator:n,source:i}=this;s.add(n?n.call(s,i):i?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(r){try{return this._subscribe(r)}catch(e){r.error(e)}}forEach(r,e){return e=K(e),new e((o,s)=>{let n=new y({next:i=>{try{r(i)}catch(p){s(p),n.unsubscribe()}},error:s,complete:o});this.subscribe(n)})}_subscribe(r){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(r)}[J](){return this}pipe(...r){return G(r)(this)}toPromise(r){return r=K(r),new r((e,o)=>{let s;this.subscribe(n=>s=n,n=>o(n),()=>e(s))})}};d.create=t=>new d(t);function K(t){var r;return(r=t??c.Promise)!==null&&r!==void 0?r:Promise}function nr(t){return t&&a(t.next)&&a(t.error)&&a(t.complete)}function ir(t){return t&&t instanceof l||nr(t)&&E(t)}function ar(t){return a(t?.lift)}function Q(t){return r=>{if(ar(r))return r.lift(function(e){try{return t(e,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function X(t,r,e,o,s){return new U(t,r,e,o,s)}var U=class extends l{constructor(r,e,o,s,n,i){super(r),this.onFinalize=n,this.shouldUnsubscribe=i,this._next=e?function(p){try{e(p)}catch(h){r.error(h)}}:super._next,this._error=s?function(p){try{s(p)}catch(h){r.error(h)}finally{this.unsubscribe()}}:super._error,this._complete=o?function(){try{o()}catch(p){r.error(p)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((r=this.onFinalize)===null||r===void 0||r.call(this))}}};var Z=T(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var M=class extends d{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(r){let e=new _(this,this);return e.operator=r,e}_throwIfClosed(){if(this.closed)throw new Z}next(r){S(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let e of this.currentObservers)e.next(r)}})}error(r){S(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=r;let{observers:e}=this;for(;e.length;)e.shift().error(r)}})}complete(){S(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:r}=this;for(;r.length;)r.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0}_trySubscribe(r){return this._throwIfClosed(),super._trySubscribe(r)}_subscribe(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)}_innerSubscribe(r){let{hasError:e,isStopped:o,observers:s}=this;return e||o?I:(this.currentObservers=null,s.push(r),new u(()=>{this.currentObservers=null,P(s,r)}))}_checkFinalizedStatuses(r){let{hasError:e,thrownError:o,isStopped:s}=this;e?r.error(o):s&&r.complete()}asObservable(){let r=new d;return r.source=this,r}};M.create=(t,r)=>new _(t,r);var _=class extends M{constructor(r,e){super(),this.destination=r,this.source=e}next(r){var e,o;(o=(e=this.destination)===null||e===void 0?void 0:e.next)===null||o===void 0||o.call(e,r)}error(r){var e,o;(o=(e=this.destination)===null||e===void 0?void 0:e.error)===null||o===void 0||o.call(e,r)}complete(){var r,e;(e=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||e===void 0||e.call(r)}_subscribe(r){var e,o;return(o=(e=this.source)===null||e===void 0?void 0:e.subscribe(r))!==null&&o!==void 0?o:I}};var m=class extends M{constructor(r){super(),this._value=r}get value(){return this.getValue()}_subscribe(r){let e=super._subscribe(r);return!e.closed&&r.next(this._value),e}getValue(){let{hasError:r,thrownError:e,_value:o}=this;if(r)throw e;return this._throwIfClosed(),o}next(r){super.next(this._value=r)}};function W(t,r){return Q((e,o)=>{let s=0;e.subscribe(X(o,n=>{o.next(t.call(r,n,s++))}))})}var j=(i=>(i.Pin="pin",i.InstagramMedia="instagram_media",i.YouTubeVideo="youtube_video",i.Article="article",i.Tweet="tweet",i.FacebookStatus="facebook_status",i))(j||{});var H=t=>{let r=new Date(t*1e3);return pr(r.getDay())},rr=t=>{let r=new Date(t*1e3);return cr(r.getHours())};var $=t=>{switch(t){case"12AM":return 0;case"1AM":return 1;case"2AM":return 2;case"3AM":return 3;case"4AM":return 4;case"5AM":return 5;case"6AM":return 6;case"7AM":return 7;case"8AM":return 8;case"9AM":return 9;case"10AM":return 10;case"11AM":return 11;case"12PM":return 12;case"1PM":return 13;case"2PM":return 14;case"3PM":return 15;case"4PM":return 16;case"5PM":return 17;case"6PM":return 18;case"7PM":return 19;case"8PM":return 20;case"9PM":return 21;case"10PM":return 22;case"11PM":return 23}},pr=t=>{switch(t){case 0:return"Sunday";case 1:return"Monday";case 2:return"Tuesday";case 3:return"Wednesday";case 4:return"Thursday";case 5:return"Friday";case 6:return"Saturday";default:return null}},cr=t=>{switch(t){case 0:return"12AM";case 1:return"1AM";case 2:return"2AM";case 3:return"3AM";case 4:return"4AM";case 5:return"5AM";case 6:return"6AM";case 7:return"7AM";case 8:return"8AM";case 9:return"9AM";case 10:return"10AM";case 11:return"11AM";case 12:return"12PM";case 13:return"1PM";case 14:return"2PM";case 15:return"3PM";case 16:return"4PM";case 17:return"5PM";case 18:return"6PM";case 19:return"7PM";case 20:return"8PM";case 21:return"9PM";case 22:return"10PM";case 23:return"11PM";default:return null}};var er=(t,r)=>{let e=$(t.hour),o=$(r.hour);return e<o?-1:e>o?1:0};var w=class w{constructor(){this.pinStats$=new m({});this.instagramMediaStats$=new m({});this.youTubeVideoStats$=new m({});this.articleStats$=new m({});this.tweetStats$=new m({});this.facebookStatusStats$=new m({});this.initSubscriptions(),this.initCommandHandler()}stats$(r){switch(r){case"pin":return this.pinStats$;case"instagram_media":return this.instagramMediaStats$;case"youtube_video":return this.youTubeVideoStats$;case"article":return this.articleStats$;case"tweet":return this.tweetStats$;case"facebook_status":return this.facebookStatusStats$}}initSubscriptions(){Object.values(j).forEach(r=>{this.stats$(r).pipe(w.mapStatsIndexToArray).subscribe(e=>this.postMessage({type:x.Messages.StatsComputed,payload:{stats:e,postType:r}}))})}initCommandHandler(){addEventListener("message",r=>{if(this.isValidCommand(r))this.handleCommand(r.data);else throw new Error(x.Errors.InvalidCommand)})}isValidCommand(r){try{return x.isValidCommand(r.data.type)}catch{return!1}}handleCommand(r){switch(r.type){case x.Commands.ComputeStats:this.computeStats(r.payload);break}}postMessage(r){postMessage(r)}computeStats({postType:r,post:e}){let o=this.stats$(r).value,s=H(e.timestamp),n=rr(e.timestamp),i=(o[s]?.[n]?.postsCount??0)+1;this.stats$(r).next({...o,[s]:{...o[s],[n]:{weekday:s,hour:n,postsCount:i}}})}};w.mapStatsIndexToArray=r=>r.pipe(W(e=>Object.values(e).flatMap(o=>Object.values(o)).sort(er)));var z=w,Ue=new z;export{Ue as statsWorker};
