var le={UpfluenceStreamURL:"https://stream.upfluence.co/stream"};var R=r=>e=>Object.values(r).includes(e);var oe=(s=>(s.Pin="pin",s.InstagramMedia="instagram_media",s.YouTubeVideo="youtube_video",s.Article="article",s.Tweet="tweet",s.FacebookStatus="facebook_status",s))(oe||{});function a(r){return typeof r=="function"}function k(r){let t=r(o=>{Error.call(o),o.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var L=k(r=>function(t){r(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((o,n)=>`${n+1}) ${o.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function j(r,e){if(r){let t=r.indexOf(e);0<=t&&r.splice(t,1)}}var d=class r{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let i of t)i.remove(this);else t.remove(this);let{initialTeardown:o}=this;if(a(o))try{o()}catch(i){e=i instanceof L?i.errors:[i]}let{_finalizers:n}=this;if(n){this._finalizers=null;for(let i of n)try{me(i)}catch(s){e=e??[],s instanceof L?e=[...e,...s.errors]:e.push(s)}}if(e)throw new L(e)}}add(e){var t;if(e&&e!==this)if(this.closed)me(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&j(t,e)}remove(e){let{_finalizers:t}=this;t&&j(t,e),e instanceof r&&e._removeParent(this)}};d.EMPTY=(()=>{let r=new d;return r.closed=!0,r})();var ne=d.EMPTY;function V(r){return r instanceof d||r&&"closed"in r&&a(r.remove)&&a(r.add)&&a(r.unsubscribe)}function me(r){a(r)?r():r.unsubscribe()}var m={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var I={setTimeout(r,e,...t){let{delegate:o}=I;return o?.setTimeout?o.setTimeout(r,e,...t):setTimeout(r,e,...t)},clearTimeout(r){let{delegate:e}=I;return(e?.clearTimeout||clearTimeout)(r)},delegate:void 0};function U(r){I.setTimeout(()=>{let{onUnhandledError:e}=m;if(e)e(r);else throw r})}function ie(){}var de=se("C",void 0,void 0);function he(r){return se("E",void 0,r)}function be(r){return se("N",r,void 0)}function se(r,e,t){return{kind:r,value:e,error:t}}var S=null;function A(r){if(m.useDeprecatedSynchronousErrorHandling){let e=!S;if(e&&(S={errorThrown:!1,error:null}),r(),e){let{errorThrown:t,error:o}=S;if(S=null,t)throw o}}else r()}function xe(r){m.useDeprecatedSynchronousErrorHandling&&S&&(S.errorThrown=!0,S.error=r)}var g=class extends d{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,V(e)&&e.add(this)):this.destination=$e}static create(e,t,o){return new F(e,t,o)}next(e){this.isStopped?ce(be(e),this):this._next(e)}error(e){this.isStopped?ce(he(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?ce(de,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Ve=Function.prototype.bind;function ae(r,e){return Ve.call(r,e)}var fe=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(o){$(o)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(o){$(o)}else $(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){$(t)}}},F=class extends g{constructor(e,t,o){super();let n;if(a(e)||!e)n={next:e??void 0,error:t??void 0,complete:o??void 0};else{let i;this&&m.useDeprecatedNextContext?(i=Object.create(e),i.unsubscribe=()=>this.unsubscribe(),n={next:e.next&&ae(e.next,i),error:e.error&&ae(e.error,i),complete:e.complete&&ae(e.complete,i)}):n=e}this.destination=new fe(n)}};function $(r){m.useDeprecatedSynchronousErrorHandling?xe(r):U(r)}function Ue(r){throw r}function ce(r,e){let{onStoppedNotification:t}=m;t&&I.setTimeout(()=>t(r,e))}var $e={closed:!0,next:ie,error:Ue,complete:ie};var M=typeof Symbol=="function"&&Symbol.observable||"@@observable";function ye(r){return r}function ve(r){return r.length===0?ye:r.length===1?r[0]:function(t){return r.reduce((o,n)=>n(o),t)}}var f=class r{constructor(e){e&&(this._subscribe=e)}lift(e){let t=new r;return t.source=this,t.operator=e,t}subscribe(e,t,o){let n=De(e)?e:new F(e,t,o);return A(()=>{let{operator:i,source:s}=this;n.add(i?i.call(n,s):s?this._subscribe(n):this._trySubscribe(n))}),n}_trySubscribe(e){try{return this._subscribe(e)}catch(t){e.error(t)}}forEach(e,t){return t=we(t),new t((o,n)=>{let i=new F({next:s=>{try{e(s)}catch(c){n(c),i.unsubscribe()}},error:n,complete:o});this.subscribe(i)})}_subscribe(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)}[M](){return this}pipe(...e){return ve(e)(this)}toPromise(e){return e=we(e),new e((t,o)=>{let n;this.subscribe(i=>n=i,i=>o(i),()=>t(n))})}};f.create=r=>new f(r);function we(r){var e;return(e=r??m.Promise)!==null&&e!==void 0?e:Promise}function Ne(r){return r&&a(r.next)&&a(r.error)&&a(r.complete)}function De(r){return r&&r instanceof g||Ne(r)&&V(r)}function ze(r){return a(r?.lift)}function h(r){return e=>{if(ze(e))return e.lift(function(t){try{return r(t,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function v(r,e,t,o,n){return new pe(r,e,t,o,n)}var pe=class extends g{constructor(e,t,o,n,i,s){super(e),this.onFinalize=i,this.shouldUnsubscribe=s,this._next=t?function(c){try{t(c)}catch(u){e.error(u)}}:super._next,this._error=n?function(c){try{n(c)}catch(u){e.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=o?function(){try{o()}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};var _e=k(r=>function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var E=class extends f{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let t=new N(this,this);return t.operator=e,t}_throwIfClosed(){if(this.closed)throw new _e}next(e){A(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let t of this.currentObservers)t.next(e)}})}error(e){A(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:t}=this;for(;t.length;)t.shift().error(e)}})}complete(){A(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:t,isStopped:o,observers:n}=this;return t||o?ne:(this.currentObservers=null,n.push(e),new d(()=>{this.currentObservers=null,j(n,e)}))}_checkFinalizedStatuses(e){let{hasError:t,thrownError:o,isStopped:n}=this;t?e.error(o):n&&e.complete()}asObservable(){let e=new f;return e.source=this,e}};E.create=(r,e)=>new N(r,e);var N=class extends E{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,o;(o=(t=this.destination)===null||t===void 0?void 0:t.next)===null||o===void 0||o.call(t,e)}error(e){var t,o;(o=(t=this.destination)===null||t===void 0?void 0:t.error)===null||o===void 0||o.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,o;return(o=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&o!==void 0?o:ne}};function Se(r){return r&&a(r.schedule)}function We(r){return r[r.length-1]}function ge(r){return Se(We(r))?r.pop():void 0}function Oe(r,e,t,o){function n(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function c(x){try{l(o.next(x))}catch(P){s(P)}}function u(x){try{l(o.throw(x))}catch(P){s(P)}}function l(x){x.done?i(x.value):n(x.value).then(c,u)}l((o=o.apply(r,e||[])).next())})}function Ee(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],o=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&o>=r.length&&(r=void 0),{value:r&&r[o++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function O(r){return this instanceof O?(this.v=r,this):new O(r)}function Pe(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=t.apply(r,e||[]),n,i=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(p){o[p]&&(n[p]=function(T){return new Promise(function(te,Le){i.push([p,T,te,Le])>1||c(p,T)})})}function c(p,T){try{u(o[p](T))}catch(te){P(i[0][3],te)}}function u(p){p.value instanceof O?Promise.resolve(p.value.v).then(l,x):P(i[0][2],p)}function l(p){c("next",p)}function x(p){c("throw",p)}function P(p,T){p(T),i.shift(),i.length&&c(i[0][0],i[0][1])}}function Te(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Ee=="function"?Ee(r):r[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(i){t[i]=r[i]&&function(s){return new Promise(function(c,u){s=r[i](s),n(c,u,s.done,s.value)})}}function n(i,s,c,u){Promise.resolve(u).then(function(l){i({value:l,done:c})},s)}}var D=r=>r&&typeof r.length=="number"&&typeof r!="function";function z(r){return a(r?.then)}function W(r){return a(r[M])}function Y(r){return Symbol.asyncIterator&&a(r?.[Symbol.asyncIterator])}function G(r){return new TypeError(`You provided ${r!==null&&typeof r=="object"?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Ye(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var B=Ye();function H(r){return a(r?.[B])}function q(r){return Pe(this,arguments,function*(){let t=r.getReader();try{for(;;){let{value:o,done:n}=yield O(t.read());if(n)return yield O(void 0);yield yield O(o)}}finally{t.releaseLock()}})}function K(r){return a(r?.getReader)}function w(r){if(r instanceof f)return r;if(r!=null){if(W(r))return Ge(r);if(D(r))return Be(r);if(z(r))return He(r);if(Y(r))return Ie(r);if(H(r))return qe(r);if(K(r))return Ke(r)}throw G(r)}function Ge(r){return new f(e=>{let t=r[M]();if(a(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Be(r){return new f(e=>{for(let t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}function He(r){return new f(e=>{r.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,U)})}function qe(r){return new f(e=>{for(let t of r)if(e.next(t),e.closed)return;e.complete()})}function Ie(r){return new f(e=>{Je(r,e).catch(t=>e.error(t))})}function Ke(r){return Ie(q(r))}function Je(r,e){var t,o,n,i;return Oe(this,void 0,void 0,function*(){try{for(t=Te(r);o=yield t.next(),!o.done;){let s=o.value;if(e.next(s),e.closed)return}}catch(s){n={error:s}}finally{try{o&&!o.done&&(i=t.return)&&(yield i.call(t))}finally{if(n)throw n.error}}e.complete()})}function b(r,e,t,o=0,n=!1){let i=e.schedule(function(){t(),n?r.add(this.schedule(null,o)):this.unsubscribe()},o);if(r.add(i),!n)return i}function J(r,e=0){return h((t,o)=>{t.subscribe(v(o,n=>b(o,r,()=>o.next(n),e),()=>b(o,r,()=>o.complete(),e),n=>b(o,r,()=>o.error(n),e)))})}function Z(r,e=0){return h((t,o)=>{o.add(r.schedule(()=>t.subscribe(o),e))})}function Ae(r,e){return w(r).pipe(Z(e),J(e))}function Fe(r,e){return w(r).pipe(Z(e),J(e))}function Me(r,e){return new f(t=>{let o=0;return e.schedule(function(){o===r.length?t.complete():(t.next(r[o++]),t.closed||this.schedule())})})}function je(r,e){return new f(t=>{let o;return b(t,e,()=>{o=r[B](),b(t,e,()=>{let n,i;try{({value:n,done:i}=o.next())}catch(s){t.error(s);return}i?t.complete():t.next(n)},0,!0)}),()=>a(o?.return)&&o.return()})}function Q(r,e){if(!r)throw new Error("Iterable cannot be null");return new f(t=>{b(t,e,()=>{let o=r[Symbol.asyncIterator]();b(t,e,()=>{o.next().then(n=>{n.done?t.complete():t.next(n.value)})},0,!0)})})}function Ce(r,e){return Q(q(r),e)}function Re(r,e){if(r!=null){if(W(r))return Ae(r,e);if(D(r))return Me(r,e);if(z(r))return Fe(r,e);if(Y(r))return Q(r,e);if(H(r))return je(r,e);if(K(r))return Ce(r,e)}throw G(r)}function ke(r,e){return e?Re(r,e):w(r)}function X(...r){let e=ge(r);return ke(r,e)}function ee(r,e){return h((t,o)=>{let n=0;t.subscribe(v(o,i=>{o.next(r.call(e,i,n++))}))})}function re(r,e){return h((t,o)=>{let n=0;t.subscribe(v(o,i=>r.call(e,i,n++)&&o.next(i)))})}function C(r){return h((e,t)=>{let o=null,n=!1,i;o=e.subscribe(v(t,void 0,void 0,s=>{i=w(r(s,C(r)(e))),o?(o.unsubscribe(),o=null,i.subscribe(t)):n=!0})),n&&(o.unsubscribe(),o=null,i.subscribe(t))})}var _;(i=>{let r;(c=>c.InitStream="INIT_STREAM")(r=i.Commands||={});let e;(l=>(l.WorkerReady="WORKER_READY",l.StreamInitialized="STREAM_INITIALIZED",l.NewPost="NewPost"))(e=i.Messages||={});let t;(u=>(u.InvalidCommand="INVALID_COMMAND",u.InvalidMessage="INVALID_MESSAGE"))(t=i.Errors||={}),i.isValidCommand=s=>R(r)(s),i.isValidMessage=s=>R(e)(s)})(_||={});var y=class y{constructor(){this.eventSource=null;this.rawEvents$=new E;this.events$=this.rawEvents$.pipe(ee(e=>JSON.parse(e)),C(()=>X(null)),re(e=>!!e));this.pin$=this.events$.pipe(y.mapEventToPostOperator("pin"));this.instagramMedia$=this.events$.pipe(y.mapEventToPostOperator("instagram_media"));this.youTubeVideo$=this.events$.pipe(y.mapEventToPostOperator("youtube_video"));this.article$=this.events$.pipe(y.mapEventToPostOperator("article"));this.tweet$=this.events$.pipe(y.mapEventToPostOperator("tweet"));this.facebookStatus$=this.events$.pipe(y.mapEventToPostOperator("facebook_status"));this.initSubscriptions(),this.initCommandHandler(),this.postMessage({type:_.Messages.WorkerReady})}posts$(e){switch(e){case"pin":return this.pin$;case"instagram_media":return this.instagramMedia$;case"youtube_video":return this.youTubeVideo$;case"article":return this.article$;case"tweet":return this.tweet$;case"facebook_status":return this.facebookStatus$}}initSubscriptions(){Object.values(oe).forEach(e=>{this.posts$(e).subscribe(t=>this.postMessage({type:_.Messages.NewPost,payload:{postType:e,post:t}}))})}initCommandHandler(){addEventListener("message",e=>{if(this.isValidCommand(e))this.handleCommand(e.data);else throw new Error(_.Errors.InvalidCommand)})}isValidCommand(e){try{return _.isValidCommand(e.data.type)}catch{return!1}}handleCommand(e){switch(e.type){case _.Commands.InitStream:this.initStream();break}}postMessage(e){postMessage(e)}initStream(){this.destroyStream();let e=new EventSource(le.UpfluenceStreamURL);e.addEventListener("open",()=>{this.postMessage({type:_.Messages.StreamInitialized})}),e.addEventListener("message",t=>{this.rawEvents$.next(t.data)}),this.eventSource=e}destroyStream(){this.eventSource?.close()}};y.mapEventToPostOperator=e=>t=>t.pipe(ee(o=>o[e]),C(()=>X(null)),re(o=>!!o));var ue=y,Qo=new ue;export{Qo as upfluenceStreamWorker};
